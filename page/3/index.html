<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
    
	<title>不知有晋</title>
    <meta name="author" content="CFONG">
    
	<meta name="description" content=""> <!-- TODO: truncate -->
	
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

	<link href="atom.xml" rel="alternate" title="不知有晋" type="application/atom+xml">
	<link href="/favicon.ico" rel="shortcut icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/custom.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/stylesheets/hljs.css" media="screen, projection" rel="stylesheet" type="text/css">

    <link href='//fonts.googleapis.com/css?family=Slackey' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Amethysta' rel='stylesheet' type='text/css'>
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.8.2/jquery.min.js"></script>
    <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![}]-->

    <script type="text/javascript" src="/javascripts/jquery-tapir.js"></script>
    <script src="/javascripts/MathJax.js" type="text/javascript"></script>
    <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
            tex2jax: {
            skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
            inlineMath: [['$','$']]
            }
        });
    </script>
    <!-- remove or comment it to disable ajaxification -->   
    <!-- <script src="/javascripts/ajaxify.js"></script> -->

    

    

<meta name="generator" content="Hexo 6.2.0"></head>


<body>
    <div id="wrapper">
    <header id="header" class="inner"><!-- for more effects see _animate.scss -->
<h1 class="animated bounceInDown">
    <div id="headerbg">
        不知有晋
    </div>
</h1>
<span class="subtitle"></span>
<br>

<ul id="social-links" style="text-align:center; clear:both;">
  
  
  
  
  
  
  
  
</ul>


<!-- use full url including 'index.html' for navigation bar if you are using ajax -->
<ul id="nav">
	<li id="ajax"><a href="/index.html">Home</a></li>
	<li id="ajax"><a href="/archives/index.html">Archives</a></li>
	<li id="ajax"><a href="/tags/index.html">Tags</a></li>
    <li><a href="/atom.xml">RSS</a></li>
    
    <li>
    <div id="dark">
        <form action="//www.google.com.hk/search" method="get" accept-charset="UTF-8" id="search">
            <input type="hidden" name="sitesearch" value="http://chenfeng.org" />
            <input type="text" name="q" results="0" placeholder="Search..." x-webkit-speech />
        </form>
    </div>
    </li>
        
</ul>




</header>

<div id="toload">
<!-- begin toload -->
    <div id="content" class="inner">
        



  <article class="post">
	<h2 class="title">
		<a href="2022/06/04/mysql/">MySQL自增ID和业务字段ID做主键的区别</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2022-06-04T06:00:00.000Z" itemprop="datePublished">Jun 4, 2022</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/mysql/">mysql</a>
</div>
    </div>
      
        <p>主键的作用是为了唯一标识出表中的一行数据，并且不能为空。</p>
<p>一、自增ID</p>
<p>自增ID作为主键的优缺点：</p>
<p>自增ID的优点</p>
<ol>
<li>ID值由数据库引擎产生，方便开发人员</li>
<li>ID值连续递增，提高数据库写入性能</li>
<li>整型类型，所需存储空间较小</li>
</ol>
<p>自增ID缺点</p>
<ol>
<li>ID值本身会暴露数据规模</li>
<li>ID值有序，容易暴露出其他ID值</li>
<li>ID值由数据库引擎自动生成，分布式环境不能做到全局唯一</li>
</ol>
<p>二、业务字段ID</p>
<p>业务字段ID作为主键可能产生的问题</p>
<ol>
<li>主键不能为空，某些业务字段可能非必需提供，或者因为隐私不能提供（例如电话号码、身份证号码）</li>
<li>业务字段ID可能遇到回收利用（例如会员号），导致在显示和统计上出错</li>
<li>业务字段ID有可能在一个表中多次出现（比如订单号）</li>
</ol>
<p>所以主键应该使用一个与业务无关的自增ID作为主键，但是也要接受自增ID的缺点。</p>
<p>三、自定义ID</p>
<p>主键除了使用自增ID，还可以自定义一个ID，例如：<br>使用：时间戳（13位）+去重整数（2位）+用户ID（后5位）作为主键ID</p>
<p>这个主键ID有20位，有序但不连续，趋势递增，有效的隐藏了数据规模，还能保证分布式环境下全局唯一。</p>
<p>随着数据规模的增加，自定义ID出现重复的概率也会增大，此时需要增加自定义ID的长度。</p>

      
	</div>

<div class="meta">
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="2022/04/01/php-array/">PHP数组合并之array_merge 和 数组相加</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2022-04-01T15:00:00.000Z" itemprop="datePublished">Apr 1, 2022</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/php/">php</a>
</div>
    </div>
      
        <p>数组合并一般会使用 array_merge 函数，其实还有数组相加运算。</p>
<p>二者的区别是：<br>当数组存在相同字符串键名时，array_merge 函数会覆盖数组元素，数组相加运算不会覆盖数组元素；<br>当存在相同数字键名时，array_merge 函数会合并所有的元素，并且重新编排键名，数组相加运算依然不会覆盖数组元素。</p>
<h2><span id="he-bing-de-shu-zu-jian-ming-hu-bu-xiang-tong">合并的数组键名互不相同</span><a href="#he-bing-de-shu-zu-jian-ming-hu-bu-xiang-tong" class="header-anchor">#</a></h2><p>array_merge 函数和 数组相加运算 都是直接合并数组，返回结果，两种合并数组的方式效果一样。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$arr1</span> = [<span class="string">&#x27;p&#x27;</span>=&gt;<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;m&#x27;</span>=&gt;<span class="string">&#x27;mysql&#x27;</span>,<span class="string">&#x27;n&#x27;</span>=&gt;<span class="string">&#x27;nginx&#x27;</span>];</span><br><span class="line"><span class="variable">$arr2</span> = [<span class="string">&#x27;j&#x27;</span>=&gt;<span class="string">&#x27;javascript&#x27;</span>,<span class="string">&#x27;h&#x27;</span>=&gt;<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;c&#x27;</span>=&gt;<span class="string">&#x27;css&#x27;</span>];</span><br><span class="line"><span class="variable">$arr3</span> = <span class="title function_ invoke__">array_merge</span>(<span class="variable">$arr1</span>,<span class="variable">$arr2</span>);</span><br><span class="line"><span class="variable">$arr4</span> = <span class="variable">$arr1</span> + <span class="variable">$arr2</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$arr3</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$arr4</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [p] =&gt; php</span><br><span class="line">    [m] =&gt; mysql</span><br><span class="line">    [n] =&gt; nginx</span><br><span class="line">    [j] =&gt; javascript</span><br><span class="line">    [h] =&gt; html</span><br><span class="line">    [c] =&gt; css</span><br><span class="line">)</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [p] =&gt; php</span><br><span class="line">    [m] =&gt; mysql</span><br><span class="line">    [n] =&gt; nginx</span><br><span class="line">    [j] =&gt; javascript</span><br><span class="line">    [h] =&gt; html</span><br><span class="line">    [c] =&gt; css</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<h2><span id="he-bing-de-shu-zu-cun-zai-xiang-tong-jian-ming">合并的数组存在相同键名</span><a href="#he-bing-de-shu-zu-cun-zai-xiang-tong-jian-ming" class="header-anchor">#</a></h2><h3><span id="shu-zu-jian-ming-shi-zi-fu-chuan">数组键名是字符串</span><a href="#shu-zu-jian-ming-shi-zi-fu-chuan" class="header-anchor">#</a></h3><p>array_merge 函数在合并每一个元素前，先判断是否已经存在相同键名，存在则 <strong>覆盖</strong> 同名元素的值，不存在则增加元素。</p>
<p>数组相加运算在合并每一个元素前，先判断是否已经存在相同键名，存在则 <strong>跳过</strong> 该元素，不存在则增加元素。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$arr1</span> = [<span class="string">&#x27;p&#x27;</span>=&gt;<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;m&#x27;</span>=&gt;<span class="string">&#x27;mysql&#x27;</span>,<span class="string">&#x27;n&#x27;</span>=&gt;<span class="string">&#x27;nginx&#x27;</span>];</span><br><span class="line"><span class="variable">$arr2</span> = [<span class="string">&#x27;j&#x27;</span>=&gt;<span class="string">&#x27;javascript&#x27;</span>,<span class="string">&#x27;n&#x27;</span>=&gt;<span class="string">&#x27;nginx2&#x27;</span>,<span class="string">&#x27;h&#x27;</span>=&gt;<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;c&#x27;</span>=&gt;<span class="string">&#x27;css&#x27;</span>];</span><br><span class="line"><span class="variable">$arr3</span> = <span class="title function_ invoke__">array_merge</span>(<span class="variable">$arr1</span>,<span class="variable">$arr2</span>);</span><br><span class="line"><span class="variable">$arr4</span> = <span class="variable">$arr1</span> + <span class="variable">$arr2</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$arr3</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$arr4</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [p] =&gt; php</span><br><span class="line">    [m] =&gt; mysql</span><br><span class="line">    [n] =&gt; nginx2</span><br><span class="line">    [j] =&gt; javascript</span><br><span class="line">    [h] =&gt; html</span><br><span class="line">    [c] =&gt; css</span><br><span class="line">)</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [p] =&gt; php</span><br><span class="line">    [m] =&gt; mysql</span><br><span class="line">    [n] =&gt; nginx</span><br><span class="line">    [j] =&gt; javascript</span><br><span class="line">    [h] =&gt; html</span><br><span class="line">    [c] =&gt; css</span><br><span class="line">)</span><br></pre></td></tr></table></figure>


<h3><span id="shu-zu-jian-ming-shi-shu-zi">数组键名是数字</span><a href="#shu-zu-jian-ming-shi-shu-zi" class="header-anchor">#</a></h3><p>当数组的键名为空时，PHP会默认键名为数字，默认数字键名与元素的位置有关。</p>
<p>以下两对数组结果一样</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;mysql&#x27;</span>,<span class="string">&#x27;nginx&#x27;</span>];</span><br><span class="line"></span><br><span class="line">[<span class="number">0</span>=&gt;’php’,<span class="number">1</span>=&gt;’mysql’,<span class="number">2</span>=&gt;’nginx<span class="string">&#x27;];</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">&#x27;j&#x27;</span>=&gt;<span class="string">&#x27;javascript&#x27;</span>,<span class="number">1</span>=&gt;<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;mysql&#x27;</span>,<span class="string">&#x27;nginx&#x27;</span>,<span class="number">3</span>=&gt;<span class="string">&#x27;html&#x27;</span>];</span><br><span class="line"></span><br><span class="line">[<span class="string">&#x27;j&#x27;</span>=&gt;<span class="string">&#x27;javascript&#x27;</span>,<span class="number">1</span>=&gt;<span class="string">&#x27;php’,2=&gt;&#x27;</span>mysql<span class="string">&#x27;,3=&gt;&#x27;</span>html<span class="string">&#x27;];</span></span><br></pre></td></tr></table></figure>

<p>array_merge 函数在合并每一个元素前，先判断键名类型是否为整型数字，若为整型数字，则增加元素，若为字符串型，则根据字符串键名的算法合并元素。最后再根据元素位置编排数字键名。</p>
<p>数组相加运算合并元素的算法跟键名为字符串的合并算法一样。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$arr1</span> = [<span class="string">&#x27;php&#x27;</span>,<span class="string">&#x27;mysql&#x27;</span>,<span class="string">&#x27;nginx&#x27;</span>];</span><br><span class="line"><span class="variable">$arr2</span> = [<span class="string">&#x27;javascript&#x27;</span>,<span class="string">&#x27;nginx2&#x27;</span>,<span class="string">&#x27;html&#x27;</span>,<span class="string">&#x27;css&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$arr3</span> = <span class="title function_ invoke__">array_merge</span>(<span class="variable">$arr1</span>,<span class="variable">$arr2</span>);</span><br><span class="line"><span class="variable">$arr4</span> = <span class="variable">$arr1</span> + <span class="variable">$arr2</span>;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$arr3</span>);</span><br><span class="line"><span class="title function_ invoke__">print_r</span>(<span class="variable">$arr4</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; php</span><br><span class="line">    [1] =&gt; mysql</span><br><span class="line">    [2] =&gt; nginx</span><br><span class="line">    [3] =&gt; javascript</span><br><span class="line">    [4] =&gt; nginx2</span><br><span class="line">    [5] =&gt; html</span><br><span class="line">    [6] =&gt; css</span><br><span class="line">)</span><br><span class="line">Array</span><br><span class="line">(</span><br><span class="line">    [0] =&gt; php</span><br><span class="line">    [1] =&gt; mysql</span><br><span class="line">    [2] =&gt; nginx</span><br><span class="line">    [3] =&gt; css</span><br><span class="line">)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
	</div>

<div class="meta">
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="2021/07/24/linux_viewing_content/">三个浏览内容的 Linux 命令功能对比</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2021-07-24T02:00:00.000Z" itemprop="datePublished">Jul 24, 2021</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/linux/">linux</a>
</div>
    </div>
      
        <div class="toc">

<!-- toc -->

<ul>
<li><a href="#cat">cat</a></li>
<li><a href="#more">more</a></li>
<li><a href="#less">less</a></li>
<li><a href="#zong-jie">总结</a></li>
</ul>
<!-- tocstop -->

</div>

<p>cat,less,more 命令都有浏览内容、文件的功能对比。</p>
<h3><span id="cat">cat</span><a href="#cat" class="header-anchor">#</a></h3><p>cat（英文全拼：concatenate）命令用于连接文件并打印到标准输出设备上。</p>
<p>cat的几个用法：</p>
<ol>
<li>显示整个文件：cat filename</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~# cat hello.html </span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">        &lt;head&gt;</span><br><span class="line">                &lt;title&gt;title&lt;/title&gt;</span><br><span class="line">        &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">        &lt;body&gt;</span><br><span class="line"></span><br><span class="line">                &lt;p&gt; Hello World&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>接收从键盘的输入，创建一个新文件： cat &gt; filename</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~# cat &gt; hello.sh</span><br><span class="line">echo &#x27;Hello World.&#x27;;</span><br><span class="line">^C</span><br></pre></td></tr></table></figure>
<p>换行后按 ctrl + c 退出即保存。</p>
<ol start="3">
<li>显示行号</li>
</ol>
<ul>
<li>不对空行编号，cat -b filename</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~# cat -b hello.html </span><br><span class="line">     1  &lt;html&gt;</span><br><span class="line"></span><br><span class="line">     2          &lt;head&gt;</span><br><span class="line">     3                  &lt;title&gt;title&lt;/title&gt;</span><br><span class="line">     4          &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">     5          &lt;body&gt;</span><br><span class="line"></span><br><span class="line">     6                  &lt;p&gt; Hello World&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">     7          &lt;/body&gt;</span><br><span class="line">     8  &lt;/html&gt;</span><br></pre></td></tr></table></figure>


<ul>
<li>对所有行顺序编号，cat -n filename</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~# cat -n hello.html  </span><br><span class="line">     1  &lt;html&gt;</span><br><span class="line">     2</span><br><span class="line">     3          &lt;head&gt;</span><br><span class="line">     4                  &lt;title&gt;title&lt;/title&gt;</span><br><span class="line">     5          &lt;/head&gt;</span><br><span class="line">     6</span><br><span class="line">     7          &lt;body&gt;</span><br><span class="line">     8</span><br><span class="line">     9                  &lt;p&gt; Hello World&lt;/p&gt;</span><br><span class="line">    10</span><br><span class="line">    11          &lt;/body&gt;</span><br><span class="line">    12  &lt;/html&gt;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>拼接文件： cat filename1 filename2 &gt; filename3</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~# cat hello.html hello.sh &gt; hello.mix</span><br><span class="line">root@ubuntu:~# cat hello.mix </span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">        &lt;head&gt;</span><br><span class="line">                &lt;title&gt;title&lt;/title&gt;</span><br><span class="line">        &lt;/head&gt;</span><br><span class="line"></span><br><span class="line">        &lt;body&gt;</span><br><span class="line"></span><br><span class="line">                &lt;p&gt; Hello World&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">echo &#x27;Hello World.&#x27;;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>cat的反向tac</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">root@ubuntu:~# tac hello.mix </span><br><span class="line">echo &#x27;Hello World.&#x27;;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line">        &lt;/body&gt;</span><br><span class="line"></span><br><span class="line">                &lt;p&gt; Hello World&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">        &lt;body&gt;</span><br><span class="line"></span><br><span class="line">        &lt;/head&gt;</span><br><span class="line">                &lt;title&gt;title&lt;/title&gt;</span><br><span class="line">        &lt;head&gt;</span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br></pre></td></tr></table></figure>

<h3><span id="more">more</span><a href="#more" class="header-anchor">#</a></h3><p>more 命令，功能类似 cat ， cat 命令是将整个文件的内容显示在屏幕上；</p>
<p>more 命令则会把文件内容分页显示，底部显示浏览进度百分比，方便阅读。</p>
<ol>
<li><p>规定一页显示的行数： more -n filename</p>
</li>
<li><p>从第n行开始显示： more +n filename</p>
</li>
<li><p>翻页</p>
<ul>
<li>向下翻一页 按 space 键</li>
<li>向上翻一页  按 b(back) 键</li>
</ul>
</li>
<li><p>退出 </p>
<ul>
<li>按 q(quit)键</li>
<li>或者翻到最后一页自动退出</li>
</ul>
</li>
</ol>
<h3><span id="less">less</span><a href="#less" class="header-anchor">#</a></h3><p>less 工具是对文件或其它输出进行分页显示的工具，功能极其强大。</p>
<ol>
<li><p>显示行号： less -N filename</p>
</li>
<li><p>显示浏览百分比： less -m filename</p>
</li>
<li><p>翻页</p>
<ul>
<li>向下翻一页 按 space 键</li>
<li>向上翻一页  按 b(back) 键</li>
<li>向下翻半页 按 d(down) 键</li>
<li>向上翻半页 按 u(up) 键</li>
</ul>
</li>
<li><p>搜索</p>
<ul>
<li>向下搜索 按 &#x2F;加搜索内容，如 &#x2F;2020</li>
<li>向上搜索 按 ?加搜索内容，如 ?2020</li>
<li>按n(next)键搜索下一个</li>
</ul>
</li>
<li><p>退出 按q(quit)键</p>
</li>
</ol>
<h3><span id="zong-jie">总结</span><a href="#zong-jie" class="header-anchor">#</a></h3><p>cat命令除了有浏览文件的功能，主要还是拼接文件的功能；</p>
<p>more 和 less 命令的功能类似，但是 less 命令的功能更加强大。</p>

      
	</div>

<div class="meta">
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="2021/07/19/open_files_limit/">修改 MySQL 可打开文件数</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2021-07-19T02:00:00.000Z" itemprop="datePublished">Jul 19, 2021</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/mysql/">mysql</a>
</div>
    </div>
      
        <div class="toc">

<!-- toc -->

<ul>
<li><a href="#ke-da-kai-wen-jian-shu-xian-zhi">可打开文件数限制</a></li>
<li><a href="#xiu-gai-mysql-open-files-limit-pei-zhi-de-zhi-de-liang-chong-fang-fa">修改 MySQL open_files_limit 配置的值的两种方法：</a></li>
</ul>
<!-- tocstop -->

</div>

<h3><span id="ke-da-kai-wen-jian-shu-xian-zhi">可打开文件数限制</span><a href="#ke-da-kai-wen-jian-shu-xian-zhi" class="header-anchor">#</a></h3><p>如果 MySQL 可打开的文件数值设置的过小，会出现 “too many open files” 的错误，这意味着一个进程已经打开了太多的文件（文件描述符），无法再打开新的文件了。</p>
<p>查看 MySQL 可打开文件数配置值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select @@open_files_limit;</span><br></pre></td></tr></table></figure>

<p>查看某一个进程(MySQL进程)已经打开的文件数 </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ll /proc/pid/fd|wc -l</span><br></pre></td></tr></table></figure>
<h3><span id="xiu-gai-mysql-open-files-limit-pei-zhi-de-zhi-de-liang-chong-fang-fa">修改 MySQL open_files_limit 配置的值的两种方法：</span><a href="#xiu-gai-mysql-open-files-limit-pei-zhi-de-zhi-de-liang-chong-fang-fa" class="header-anchor">#</a></h3><h4><span id="1-tong-guo-xiu-gai-mysql-xi-tong-bian-liang-max-connections-table-open-cache-huo-zhe-xiu-gai-xi-tong-ke-da-kai-zui-da-wen-jian-miao-shu-fu-de-shu-liang-lai-xiu-gai-open-files-limit-de-zhi">1.通过修改 MySQL 系统变量 max_connections 、 table_open_cache 或者 修改系统可打开最大文件描述符的数量 来修改 open_files_limit 的值</span><a href="#1-tong-guo-xiu-gai-mysql-xi-tong-bian-liang-max-connections-table-open-cache-huo-zhe-xiu-gai-xi-tong-ke-da-kai-zui-da-wen-jian-miao-shu-fu-de-shu-liang-lai-xiu-gai-open-files-limit-de-zhi" class="header-anchor">#</a></h4><p>MySQL 官方文档对这个字段的描述，<a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/server-system-variables.html#sysvar_open_files_limit">open_files_limit</a> 实际的取值会从下面四个值当中获取最大的。</p>
<ul>
<li>10 + max_connections + (table_open_cache * 2)</li>
<li>max_connections * 5</li>
<li>MySQL 8.0.19 and higher: The operating system limit.</li>
<li>Prior to MySQL 8.0.19:<ul>
<li>The operating system limit if that limit is positive but not Infinity.</li>
<li>If the operating system limit is Infinity: open_files_limit value if specified at startup, 5000 if not.</li>
</ul>
</li>
</ul>
<p>通过修改 MySQL 系统变量 max_connections 、 table_open_cache 或者 修改系统可打开最大文件描述符的数量 来修改 open_files_limit 的值。</p>
<h4><span id="2-xiu-gai-mysql-de-xi-tong-fu-wu-wen-jian">2. 修改 MySQL 的系统服务文件</span><a href="#2-xiu-gai-mysql-de-xi-tong-fu-wu-wen-jian" class="header-anchor">#</a></h4><p>通过查看 MySQL 状态命令 <code>service mysql status</code>，查看MySQL的系统服务文件(MySQL systemd service file)。</p>
<img src="http://tva4.sinaimg.cn/large/7d4c6366gy1gsb9iu6wrbj20wg087q3j.jpg" width="700" align="bottom">

<p>在 <strong>mysql.service</strong> 文件的同级目录创建目录 <strong>mysql.service.d</strong>，并在目录里创建文件 <strong>limits.conf</strong> ，文件内容如下：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">/lib/systemd/system/mysql.service.d/limits.conf</span></span><br><span class="line">[Service]</span><br><span class="line">LimitNOFILE=20480</span><br></pre></td></tr></table></figure>

<p>修改完后继续执行以下两条命令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload    # 重新加载配置文件</span><br><span class="line">service mysql restart    # 重启mysqld服务，使配置生效</span><br></pre></td></tr></table></figure>
      
	</div>

<div class="meta">
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="2021/06/28/javascript-format/">使用JavaScript格式化数组字符串</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2021-06-28T23:00:00.000Z" itemprop="datePublished">Jun 29, 2021</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/javascript/">javascript</a>
</div>
    </div>
      
        <h4><span id="ge-shi-hua-gui-ze">格式化规则</span><a href="#ge-shi-hua-gui-ze" class="header-anchor">#</a></h4><ol>
<li><code>[</code> 后面跟 <code>[</code> ，换行，增加缩进</li>
<li><code>,</code> 后面跟 <code>[</code> ，换行，增加缩进</li>
<li><code>]</code> 后面跟 <code>,</code> ，换行，缩进</li>
<li><code>]</code> 后面跟 <code>]</code> ，换行，减少缩进</li>
</ol>
<h4><span id="guan-yu-huan-xing">关于换行</span><a href="#guan-yu-huan-xing" class="header-anchor">#</a></h4><ol>
<li>HTML页面显示，使用 <code>&lt;br&gt;</code> 换行</li>
<li>输入框显示，使用 <code>\n</code> 换行</li>
</ol>
<h4><span id="ge-shi-hua-han-shu">格式化函数</span><a href="#ge-shi-hua-han-shu" class="header-anchor">#</a></h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">title</span>&gt;</span>json<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> formatArrString = <span class="keyword">function</span>(<span class="params">conf</span>) </span></span><br><span class="line"><span class="language-javascript">            &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> html = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> tmp = <span class="string">&quot;&quot;</span>;       <span class="comment">// 临时存储字符串</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> level = <span class="number">0</span>;      <span class="comment">// 缩进行数          </span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">let</span> num = <span class="number">4</span>;        <span class="comment">// 缩进空格数</span></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">for</span>(<span class="keyword">let</span> i=<span class="number">0</span>;i&lt;conf.<span class="property">length</span>;i++)</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    tmp += conf.<span class="title function_">charAt</span>(i);</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span>(conf.<span class="title function_">charAt</span>(i) == <span class="string">&#x27;[&#x27;</span> &amp;&amp; conf.<span class="title function_">charAt</span>(i+<span class="number">1</span>) == <span class="string">&#x27;[&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">                    &#123;</span></span><br><span class="line"><span class="language-javascript">                        html += tmp;</span></span><br><span class="line"><span class="language-javascript">                        html += <span class="string">&quot;&lt;br&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">                        level += num;</span></span><br><span class="line"><span class="language-javascript">                        tmp = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>;j&lt;level;j++)</span></span><br><span class="line"><span class="language-javascript">                            html += <span class="string">&quot;\xa0&quot;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span>(conf.<span class="title function_">charAt</span>(i) == <span class="string">&#x27;,&#x27;</span> &amp;&amp; conf.<span class="title function_">charAt</span>(i+<span class="number">1</span>) == <span class="string">&#x27;[&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">                    &#123;</span></span><br><span class="line"><span class="language-javascript">                        html += tmp;</span></span><br><span class="line"><span class="language-javascript">                        html += <span class="string">&quot;&lt;br&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">                        level += num;</span></span><br><span class="line"><span class="language-javascript">                        tmp = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>;j&lt;level;j++)</span></span><br><span class="line"><span class="language-javascript">                            html += <span class="string">&quot;\xa0&quot;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">if</span>(conf.<span class="title function_">charAt</span>(i) == <span class="string">&#x27;]&#x27;</span> &amp;&amp; conf.<span class="title function_">charAt</span>(i+<span class="number">1</span>) == <span class="string">&#x27;,&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">                    &#123;</span></span><br><span class="line"><span class="language-javascript">                        html += tmp;</span></span><br><span class="line"><span class="language-javascript">                        tmp = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">                        level -= num;</span></span><br><span class="line"><span class="language-javascript">                    &#125; <span class="keyword">else</span> <span class="keyword">if</span>(conf.<span class="title function_">charAt</span>(i) == <span class="string">&#x27;]&#x27;</span> &amp;&amp; conf.<span class="title function_">charAt</span>(i+<span class="number">1</span>) == <span class="string">&#x27;]&#x27;</span>)</span></span><br><span class="line"><span class="language-javascript">                    &#123;</span></span><br><span class="line"><span class="language-javascript">                        html += tmp;</span></span><br><span class="line"><span class="language-javascript">                        tmp = <span class="string">&quot;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">                        html += <span class="string">&quot;&lt;br&gt;&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">                        level -= num;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">for</span>(<span class="keyword">let</span> j=<span class="number">0</span>;j&lt;level;j++)</span></span><br><span class="line"><span class="language-javascript">                            html += <span class="string">&quot;\xa0&quot;</span></span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">                html += tmp;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> html;</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> conf = <span class="string">&quot;[[667,3,[[99999999999,10900,[[99999999999,20000000,1000],[20000000,10000000,900],[10000000,5000000,800],[5000000,1000000,700]]],[10900,10600,[[99999999999,20000000,900],[20000000,10000000,800],[10000000,5000000,700],[5000000,1000000,600]]],[10600,10300,[[99999999999,20000000,800],[20000000,10000000,700],[10000000,5000000,600],[5000000,1000000,500]]],[10300,10000,[[99999999999,20000000,700],[20000000,10000000,600],[10000000,5000000,500],[5000000,1000000,400]]],[9000,7000,[[-99999999999,-20000000,-250],[-20000000,-10000000,-200],[-10000000,-5000000,-200],[-5000000,-1000000,-200]]],[7000,0,[[-99999999999,-20000000,-300],[-20000000,-10000000,-200],[-10000000,-5000000,-200],[-5000000,-1000000,-200]]]]],[2405,3,[[99999999999,10900,[[99999999999,20000000,1000],[20000000,10000000,900],[10000000,5000000,800],[5000000,1000000,700]]],[10900,10600,[[99999999999,20000000,900],[20000000,10000000,800],[10000000,5000000,700],[5000000,1000000,600]]],[10600,10300,[[99999999999,20000000,800],[20000000,10000000,700],[10000000,5000000,600],[5000000,1000000,500]]],[10300,10000,[[99999999999,20000000,700],[20000000,10000000,600],[10000000,5000000,500],[5000000,1000000,400]]],[9000,7000,[[-99999999999,-20000000,-250],[-20000000,-10000000,-200],[-10000000,-5000000,-200],[-5000000,-1000000,-200]]],[7000,0,[[-99999999999,-20000000,-300],[-20000000,-10000000,-200],[-10000000,-5000000,-200],[-5000000,-1000000,-200]]]]]]&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">            <span class="variable language_">document</span>.<span class="title function_">write</span>(<span class="title function_">formatArrString</span>(conf));</span></span><br><span class="line"><span class="language-javascript">        </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4><span id="ge-shi-hua-xiao-guo">格式化效果</span><a href="#ge-shi-hua-xiao-guo" class="header-anchor">#</a></h4><ol>
<li>使用 <a target="_blank" rel="noopener" href="https://www.bejson.com/">bejson</a> 格式化出来的效果</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    [667, 3, [</span><br><span class="line">        [99999999999, 10900, [</span><br><span class="line">            [99999999999, 20000000, 1000],</span><br><span class="line">            [20000000, 10000000, 900],</span><br><span class="line">            [10000000, 5000000, 800],</span><br><span class="line">            [5000000, 1000000, 700]</span><br><span class="line">        ]],</span><br><span class="line">        [10900, 10600, [</span><br><span class="line">            [99999999999, 20000000, 900],</span><br><span class="line">            [20000000, 10000000, 800],</span><br><span class="line">            [10000000, 5000000, 700],</span><br><span class="line">            [5000000, 1000000, 600]</span><br><span class="line">        ]],</span><br><span class="line">        [10600, 10300, [</span><br><span class="line">            [99999999999, 20000000, 800],</span><br><span class="line">            [20000000, 10000000, 700],</span><br><span class="line">            [10000000, 5000000, 600],</span><br><span class="line">            [5000000, 1000000, 500]</span><br><span class="line">        ]],</span><br><span class="line">        [10300, 10000, [</span><br><span class="line">            [99999999999, 20000000, 700],</span><br><span class="line">            [20000000, 10000000, 600],</span><br><span class="line">            [10000000, 5000000, 500],</span><br><span class="line">            [5000000, 1000000, 400]</span><br><span class="line">        ]],</span><br><span class="line">        [9000, 7000, [</span><br><span class="line">            [-99999999999, -20000000, -250],</span><br><span class="line">            [-20000000, -10000000, -200],</span><br><span class="line">            [-10000000, -5000000, -200],</span><br><span class="line">            [-5000000, -1000000, -200]</span><br><span class="line">        ]],</span><br><span class="line">        [7000, 0, [</span><br><span class="line">            [-99999999999, -20000000, -300],</span><br><span class="line">            [-20000000, -10000000, -200],</span><br><span class="line">            [-10000000, -5000000, -200],</span><br><span class="line">            [-5000000, -1000000, -200]</span><br><span class="line">        ]]</span><br><span class="line">    ]],</span><br><span class="line">    [2405, 3, [</span><br><span class="line">        [99999999999, 10900, [</span><br><span class="line">            [99999999999, 20000000, 1000],</span><br><span class="line">            [20000000, 10000000, 900],</span><br><span class="line">            [10000000, 5000000, 800],</span><br><span class="line">            [5000000, 1000000, 700]</span><br><span class="line">        ]],</span><br><span class="line">        [10900, 10600, [</span><br><span class="line">            [99999999999, 20000000, 900],</span><br><span class="line">            [20000000, 10000000, 800],</span><br><span class="line">            [10000000, 5000000, 700],</span><br><span class="line">            [5000000, 1000000, 600]</span><br><span class="line">        ]],</span><br><span class="line">        [10600, 10300, [</span><br><span class="line">            [99999999999, 20000000, 800],</span><br><span class="line">            [20000000, 10000000, 700],</span><br><span class="line">            [10000000, 5000000, 600],</span><br><span class="line">            [5000000, 1000000, 500]</span><br><span class="line">        ]],</span><br><span class="line">        [10300, 10000, [</span><br><span class="line">            [99999999999, 20000000, 700],</span><br><span class="line">            [20000000, 10000000, 600],</span><br><span class="line">            [10000000, 5000000, 500],</span><br><span class="line">            [5000000, 1000000, 400]</span><br><span class="line">        ]],</span><br><span class="line">        [9000, 7000, [</span><br><span class="line">            [-99999999999, -20000000, -250],</span><br><span class="line">            [-20000000, -10000000, -200],</span><br><span class="line">            [-10000000, -5000000, -200],</span><br><span class="line">            [-5000000, -1000000, -200]</span><br><span class="line">        ]],</span><br><span class="line">        [7000, 0, [</span><br><span class="line">            [-99999999999, -20000000, -300],</span><br><span class="line">            [-20000000, -10000000, -200],</span><br><span class="line">            [-10000000, -5000000, -200],</span><br><span class="line">            [-5000000, -1000000, -200]</span><br><span class="line">        ]]</span><br><span class="line">    ]]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<p>2.使用 formatArrString 函数格式化出来的效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">    [667,3,</span><br><span class="line">        [</span><br><span class="line">            [99999999999,10900,</span><br><span class="line">                [</span><br><span class="line">                    [99999999999,20000000,1000],</span><br><span class="line">                    [20000000,10000000,900],</span><br><span class="line">                    [10000000,5000000,800],</span><br><span class="line">                    [5000000,1000000,700]</span><br><span class="line">                ]</span><br><span class="line">            ],</span><br><span class="line">            [10900,10600,</span><br><span class="line">                [</span><br><span class="line">                    [99999999999,20000000,900],</span><br><span class="line">                    [20000000,10000000,800],</span><br><span class="line">                    [10000000,5000000,700],</span><br><span class="line">                    [5000000,1000000,600]</span><br><span class="line">                ]</span><br><span class="line">            ],</span><br><span class="line">            [10600,10300,</span><br><span class="line">                [</span><br><span class="line">                    [99999999999,20000000,800],</span><br><span class="line">                    [20000000,10000000,700],</span><br><span class="line">                    [10000000,5000000,600],</span><br><span class="line">                    [5000000,1000000,500]</span><br><span class="line">                ]</span><br><span class="line">            ],</span><br><span class="line">            [10300,10000,</span><br><span class="line">                [</span><br><span class="line">                    [99999999999,20000000,700],</span><br><span class="line">                    [20000000,10000000,600],</span><br><span class="line">                    [10000000,5000000,500],</span><br><span class="line">                    [5000000,1000000,400]</span><br><span class="line">                ]</span><br><span class="line">            ],</span><br><span class="line">            [9000,7000,</span><br><span class="line">                [</span><br><span class="line">                    [-99999999999,-20000000,-250],</span><br><span class="line">                    [-20000000,-10000000,-200],</span><br><span class="line">                    [-10000000,-5000000,-200],</span><br><span class="line">                    [-5000000,-1000000,-200]</span><br><span class="line">                ]</span><br><span class="line">            ],</span><br><span class="line">            [7000,0,</span><br><span class="line">                [</span><br><span class="line">                    [-99999999999,-20000000,-300],</span><br><span class="line">                    [-20000000,-10000000,-200],</span><br><span class="line">                    [-10000000,-5000000,-200],</span><br><span class="line">                    [-5000000,-1000000,-200]</span><br><span class="line">                ]</span><br><span class="line">            ]</span><br><span class="line">        ]</span><br><span class="line">    ],</span><br><span class="line">    [2405,3,</span><br><span class="line">        [</span><br><span class="line">            [99999999999,10900,</span><br><span class="line">                [</span><br><span class="line">                    [99999999999,20000000,1000],</span><br><span class="line">                    [20000000,10000000,900],</span><br><span class="line">                    [10000000,5000000,800],</span><br><span class="line">                    [5000000,1000000,700]</span><br><span class="line">                ]</span><br><span class="line">            ],</span><br><span class="line">            [10900,10600,</span><br><span class="line">                [</span><br><span class="line">                    [99999999999,20000000,900],</span><br><span class="line">                    [20000000,10000000,800],</span><br><span class="line">                    [10000000,5000000,700],</span><br><span class="line">                    [5000000,1000000,600]</span><br><span class="line">                ]</span><br><span class="line">            ],</span><br><span class="line">            [10600,10300,</span><br><span class="line">                [</span><br><span class="line">                    [99999999999,20000000,800],</span><br><span class="line">                    [20000000,10000000,700],</span><br><span class="line">                    [10000000,5000000,600],</span><br><span class="line">                    [5000000,1000000,500]</span><br><span class="line">                ]</span><br><span class="line">            ],</span><br><span class="line">            [10300,10000,</span><br><span class="line">                [</span><br><span class="line">                    [99999999999,20000000,700],</span><br><span class="line">                    [20000000,10000000,600],</span><br><span class="line">                    [10000000,5000000,500],</span><br><span class="line">                    [5000000,1000000,400]</span><br><span class="line">                ]</span><br><span class="line">            ],</span><br><span class="line">            [9000,7000,</span><br><span class="line">                [</span><br><span class="line">                    [-99999999999,-20000000,-250],</span><br><span class="line">                    [-20000000,-10000000,-200],</span><br><span class="line">                    [-10000000,-5000000,-200],</span><br><span class="line">                    [-5000000,-1000000,-200]</span><br><span class="line">                ]</span><br><span class="line">            ],</span><br><span class="line">            [7000,0,</span><br><span class="line">                [</span><br><span class="line">                    [-99999999999,-20000000,-300],</span><br><span class="line">                    [-20000000,-10000000,-200],</span><br><span class="line">                    [-10000000,-5000000,-200],</span><br><span class="line">                    [-5000000,-1000000,-200]</span><br><span class="line">                ]</span><br><span class="line">            ]</span><br><span class="line">        ]</span><br><span class="line">    ]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
      
	</div>

<div class="meta">
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="2021/05/22/skydive-dubai/">迪拜跳伞记</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2021-05-22T10:00:00.000Z" itemprop="datePublished">May 22, 2021</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/游玩/">游玩</a>
</div>
    </div>
      
        <p>来迪拜半年有余了，因为疫情的关系，很少出门。</p>
<p>最近终于打了第二针疫苗，于是想要出去浪的心情逐渐暴露出来了。</p>
<p>一直听闻迪拜跳伞很有名，来迪拜不跳伞，就相当于白来了。</p>
<p>于是就发起了个跳伞的活动，没想到平时叫的最大声的人都不去，最后只有一个小伙伴也想去玩，于是就组队成功了。</p>
<h4><span id="bao-ming">报名</span><a href="#bao-ming" class="header-anchor">#</a></h4><p>确定人数后就可以去官方网站报名了，我们选择的是棕榈岛双人跳伞，总的费用大约是2400(AED)。</p>
<p>报名的表单需要提供个人信息（包括：邮箱，电话，ID或者护照，等等），提交信息后需要先交999(AED)作为定金，并且说明了，如果最后没有去跳伞，定金不给退还。</p>
<p>报名成功后还要签署一份免责声明，填写保险的信息。</p>
<p>填写到这一步，心里多少有点慌的，但是理性的想一下，但凡有点危险的娱乐活动，商家都会要求消费者签署这样一份免责声明，所以就继续填写提交了。</p>
<p>最后官方发送一份邮件过来，确认邮箱地址的正确性，邮箱地址用于后期收发照片和视频。</p>
<p>最终跳伞的时间确定在5月22日，周六，下午一点半（这个时间是到达签到的时间）。</p>
<p>因为签署了免责声明，购买的意外险的原因，报名后的几天总是想起这个事情，一想到就觉得恐惧和犹豫。</p>
<p>每当感到恐惧的时候就去油管上看一下官方发布的跳伞视频，看一下那些勇士无所畏惧的表情，纵身一跃，体验重力加速度的快感，在空中自由飞翔，在棕榈岛上空遨游。</p>
<p>通过不断的看视频，不断的给自己做心理建设，让自己相信教练团队是专业的，跳伞设备是安全有效的，一项惊险刺激极限运动在等着我。</p>
<h4><span id="qian-dao">签到</span><a href="#qian-dao" class="header-anchor">#</a></h4><p>5月22日当天，午饭后就开车前往目的地。<br>因为我们住的地方距离目的地不远，所以其实我们是踩着点出发的。</p>
<p>在快要到达目的地的时候，看到空中飘着几片东西，像风筝。<br>随着距离靠近，就能清晰的看出其实是降落伞。有的是单人的，有的是双人的，在空中左旋右摆，缓缓降落。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNgy1gqt29zr3rwj30yi0jiq5u.jpg" width="700" align="bottom">

<p>停好车，直接进入大厅，找柜台的工作人员签到。<br>工作人员给我测一下体重，这个在官网上有说明的，体重和BMI都有要求，其实这个不用太在意，只要不是长得太胖都不会有问题。</p>
<p>然后支付剩余的费用，因为报名的时候看到的价格是2400左右，但是现场只支付了1080，加上999定金，总的费用没有对上，但是因为沟通有点问题，所以也懒得详细问了。</p>
<p>给钱后收到一张小票，小票上有姓名和排队的号码。<br>这个小票是工作人员确认身份的凭证，所以要保管好。</p>
<p>接着上二楼休息，等待。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNgy1gqt2v8448gj31400u0u0y.jpg" width="700" align="bottom">
<center>等待</center>

<p>等了10来分钟后，有个脏辫大叔过来叫名字，确认身份后就带我们去一个会议室，看一会官方的宣传视频，主要是介绍跳伞的的过程和一些注意事项，中英双字幕，看起来无障碍。</p>
<p>跟我们一起跳伞的还有一对情侣和一个略彪悍的白人男子，他声称自己已经跳了8次了，脏辫大叔立刻表示出敬意。</p>
<p>接着去到一楼寄存随身物品，等待教练，等待的过程中可以看一下墙上的屏幕，找到自己的名字，可以看到自己的出发倒计时。</p>
<p>大约过了二十分钟，教练过来叫名字，领着我去穿戴跳伞装备。<br>接着指着提示板，教我做几个跳伞的动作，提示板上用中文解释了每个动作，做起来也很容易。</p>
<p>接着有个摄影的小哥过来给我拍照，然后例行采访一下。这个摄影小哥就是我的专属摄像，待会会跟着我们一起跳下来，在打开降落伞之前全程拍照。</p>
<h4><span id="tiao-san">跳伞</span><a href="#tiao-san" class="header-anchor">#</a></h4><p>所有人员准备就绪后就开始出发了，一辆大卡车载着我们一行人去到1000米外的停机坪，每个人配有一个跳伞教练和一个摄影，总共15人，一个小飞机塞得满满的。</p>
<p>由于我上大卡车的时候坐到了最里面，所以下车的时候也走在了后面，自然就是最迟上飞机的人，我就坐在飞机拉闸门的门口。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNgy1gqt180x99fj31900u0e86.jpg" width="700" align="bottom">
<center>上飞机</center>

<p>五月的迪拜，室外温度直逼40℃，机舱里闷热又拥挤，我只能把脸凑近背后那个很小的冷气出风口，尽量缓解一下闷热。</p>
<p>飞机缓慢爬升，透过拉闸门可以看到湛蓝的海水，游艇，棕榈岛上的别墅区，海边的高楼，远处正在建设的建筑，更远处的沙漠，从繁华到荒凉，一览无余。</p>
<p>飞机爬到五千英尺（约1500m）的时候，教练员们调整坐姿，集体向飞机尾部靠拢，使飞机重心后移，此时飞机的拉闸门被打开，清凉的风瞬间灌进机舱，一扫闷热，让人神清气爽。</p>
<p>飞机继续在向上爬升。</p>
<p>拉闸门距离我仅一步，透过机舱门，俯瞰湛蓝的海平面，浅黄色的陆地和灰蒙蒙的远方，如果迪拜有底色，我觉得就是荒凉色。</p>
<p>我右手紧紧握住门把手，左手按着教练的膝盖，望着窗外出神了，教练不断的对我喊：Relax…Relax…<br>，按着我的肩膀给我放松。我假装镇定的，用手指在他的膝盖上随意的打拍子。</p>
<p>飞机在一万三千英尺（约4000m）的地方停止爬升，水平慢速飞行。教练示意我坐到他大腿上，跟他绑定到一起，给我戴上风镜，然后又跟我确认了一遍跳伞的动作，这就准备好了。</p>
<p>一起来的小伙伴正对着机舱门，他率先跳下，我接着他后面。</p>
<p>终于轮到我了，教练推着我，我半蹲着，慢慢的挪到机舱门口。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNgy1gqt1aabrxjj31900u0u12.jpg" width="700" align="bottom">
<center>准备了</center>

<p>眼前一幕震撼到我了，蓝天、白云、海洋、城市，大自然的一切都很大、很高、很远，甚至没有边界，而我等如尘埃一般在空中飘着，我们太渺小了。</p>
<p>寒风呼呼呼的扑面而来，我感觉到凉，甚至有点冷了；机舱里开始躁动起来，嘶吼的声音夹杂着肾上腺素，令人振奋。</p>
<p>此时我脑子已经空白了，没有恐惧，没有紧张，什么想法都没有，只有服从教练的指示。</p>
<p>此时摄影小哥给我做了个手势，提示我，要看着他（的镜头）。<br>教练提示我握紧肩带，接着一点示意都没有，一个翻身就把我带出去了。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNgy1gqt1dn48wyj31900u0kjp.jpg" width="700" align="bottom">
<center>跳了</center>


<p>我感觉在空中翻转了几圈，然后头朝下，向下俯冲。</p>
<p>我感觉到我被一块巨石压着，不是很沉，但就是顶着我，我感觉到越来越快。</p>
<p>我感觉风很猛烈，鼻子呼吸不了，可能是太紧张了，所以只能通过嘴大口呼气。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNgy1gqt1fsy63xj31900u0x6s.jpg" width="700" align="bottom">
<center>俯冲</center>

<p>我感觉到我脸上的肉发生了位移，我的嘴被风吹得合不上，表情已经不能有效管理了。</p>
<p>我双手紧紧的握着肩带，我感觉双手像被固定了一样，撑不开手指。</p>
<p>教练拍了拍我的肩膀，示意我可以放开双手了。</p>
<p>我如鹰一样张开双翅，我感觉我在飞，这种感觉真实太爽了。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNgy1gqt1icwi3xj31900u01l1.jpg" width="700" align="bottom">
<center>飞了</center>

<p>教练踢了踢我的脚，示意我把脚翘得高一点。我调整了一下姿势，把身体凹成一个香蕉那样，继续坠落。</p>
<p>摄影小哥如蜘蛛侠一般，随意调整速度。忽远忽近，忽上忽下，时而跟我们招手，时而围着我们旋转，我知道他在帮我拍照录视频，所以也很配合的做一些动作。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNgy1gqt1xl1tatj31900u0x6u.jpg" width="700" align="bottom">

<p>根据官方网站的介绍，我此刻正在以120英里每小时（约200km&#x2F;h）的速度在下落，这太不可思议了。</p>
<p>自由落体一段时间后，教练跟摄影小哥比了个手势，摄影小哥就飞走了，随后教练打开了降落伞。巨大的拉力拉住了我，我感觉被往上拉回去一般，大腿感觉到被勒住，勒紧了，耳朵瞬间感觉到耳鸣。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNgy1gqt213r8wbj31900u0x6t.jpg" width="700" align="bottom">
<center>开伞的一瞬间</center>

<p>不过，当时身体的这些不适感都不重要，不在乎了，因为我刚刚经历了极度惊险，极度刺激的坠落，我感觉情绪已经拉满了。</p>
<p>甚至出现某种幻觉，我感觉世界就只有我一个人，我的周围一个人也没有，地面、海面都太遥远了，所有的东西都很渺小。</p>
<p>我完全放开了的吼叫，尖叫，乱叫，直到感觉够了，没力气了，才停止下来。</p>
<p>我开始意识到我在降落，教练控制着降落伞在空中一会向左飞，一会向右飞，一会儿直线下落，偶尔出现得失重感使我开始紧张起来，我又一次紧紧的握住肩带。</p>
<p>在快要着陆的时候，教练提示我戴好口罩，但是我感觉到手指已经没力了，只能勉强的把口罩扣好，暂时拉到下巴下面，等待着陆后再做调整。</p>
<p>着陆的动作是跳伞的最后一个动作，只要把双脚抬高，让教练控制着陆地点就好。</p>
<img src="https://tva1.sinaimg.cn/large/008i3skNgy1gqt243gnb1j31900u0u14.jpg" width="700" align="bottom">
<center>着陆的一瞬间</center>

<p>摄影小哥提示我照片和视频会在一天内会通过电子邮件发送给我，随后就回大厅休息了。</p>
<p>回想刚刚过去的十几分钟，我感觉耗尽了我这一天的全部能量，我感觉到疲劳和睡意，我需要缓一下。</p>
<p>在大厅的二楼找了个地方坐下来，喝水缓解一下耳鸣，吃点东西恢复一下体力。</p>
<p>开车回家的一路上，脑子感觉不会思考了，想的都是刚刚发生的事情，所以开的很慢，幸好是周末，路上的车也不多。</p>
<h4><span id="gan-shou">感受</span><a href="#gan-shou" class="header-anchor">#</a></h4><p>回到家后什么都不想做了，不想喝水，没有食欲，不想刷手机，彷佛得到了巨大的满足感。</p>
<p>脑子像是被刷过似的，回忆尽是与跳伞有关的画面。<br>那一分钟的极速坠落像一部漫长的电影，在脑海里循环播放；那一分钟彷佛跑了一场马拉松，身心俱疲，但是相当有成就感。</p>
<p>这种感觉，很难通过文字描述清楚，别人也很难通过文字体会得到，所以我觉得，有机会有条件的话，还是应该亲自去体验一下。</p>
<p>只有体验过刺激的才能明白什么是刺激，只有吃过好吃的才能明白什么是好吃，只有自己体验过了，才能理解别人的感受。</p>

      
	</div>

<div class="meta">
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="2021/04/06/telegram/">Telegram Bot</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2021-04-06T16:00:00.000Z" itemprop="datePublished">Apr 7, 2021</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/telegram/">telegram</a>
</div>
    </div>
      
        <h4><span id="chuang-jian-bot">创建 Bot</span><a href="#chuang-jian-bot" class="header-anchor">#</a></h4><p>查找官方账号 BotFather ，带有头像，并且账号名右边带后蓝色标志的就是。</p>
<p>点击 &#x2F;start 指令后，显示有常用的指令和使用说明。<br><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpaqbjyahzj30u00vy0y6.jpg" width="700" align="bottom"></p>
<center>BotFather</center>

<ol>
<li>点击 &#x2F;newbot 指令，开始创建 Bot</li>
<li>首先输入 Bot 的名字（不会做唯一性检测）</li>
<li>接着输入 Bot 的账户名（做唯一性检测），账户名必须以 bot 作为后缀</li>
<li>最后会返回 Bot 的token，token可以看作是 Bot 的唯一ID，不可泄漏<img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpaqblzj00j30u00vyn3y.jpg" width="700" align="bottom">
<center>创建Bot</center></li>
</ol>
<h4><span id="bot-fa-xiao-xi-dao-user">Bot 发消息到 User</span><a href="#bot-fa-xiao-xi-dao-user" class="header-anchor">#</a></h4><p>查找刚刚创建的Bot，账号 testRebot_Bot ,点击 &#x2F;start 指令。<br><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpaqdetna7j30u00vydh6.jpg" width="700" align="bottom"></p>
<center>testRebot_Bot</center>

<p>Bot 发消息到 User ，使用 API ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.telegram.org/bot&lt;token&gt;/sendMessage?chat_id=&lt;user_id&gt;&amp;text=&lt;message&gt;</span><br></pre></td></tr></table></figure>
<p>尖括号里的三个参数分别是 Bot 的token，User 的 id 和发送的消息。</p>
<p>查找官方账号 userinfobot ，点击 &#x2F;start 指令，就会返回 User 的信息，其中就包括了 User 的 id。<br><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpaqdg4b5dj30u00vydhg.jpg" width="700" align="bottom"></p>
<center>石碑</center>

<p>通过浏览器访问接口：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.telegram.org/bot1715369074:AAHGwoVNoWDAT8YMmuwARH4LMIJO5oGduJg/sendMessage?chat_id=&lt;user_id&gt;&amp;text=Hello World!</span><br></pre></td></tr></table></figure>
<p>可得到成功的返回结果。通过 Telegram 可知 ，确实收到了 Bot 发来的测试消息。<br><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpaqfehhf0j30u00vy0ug.jpg" width="700" align="bottom"></p>
<center>石碑</center>



<h4><span id="bot-fa-xiao-xi-dao-group">Bot 发消息到 Group</span><a href="#bot-fa-xiao-xi-dao-group" class="header-anchor">#</a></h4><p>与发送消息到 User 的 API 一样，唯一的区别是参数 chat_id 要换成群组id。</p>
<p>首先把 Bot 拉到一个群组里面，发送一条消息，激活群组。</p>
<img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpaqg4f0r6j30u00yv0u6.jpg" width="700" align="bottom">
<center>群组</center>

<p>通过API：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.telegram.org/bot&lt;token&gt;/getUpdates</span><br></pre></td></tr></table></figure>
<p>可以查看 Bot 所在群组的群组id。</p>
<p>通过浏览器访问接口：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.telegram.org/bot1715369074:AAHGwoVNoWDAT8YMmuwARH4LMIJO5oGduJg/getUpdates</span><br></pre></td></tr></table></figure>
<p>可得群组id为：-564051528。<br><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpaqg6mrpmj30v20e2gmu.jpg" width="700" align="bottom"></p>
<center>群组id</center>

<p>通过浏览器访问接口：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://api.telegram.org/bot1715369074:AAHGwoVNoWDAT8YMmuwARH4LMIJO5oGduJg/sendMessage?chat_id=-564051528&amp;text=Hello Group!</span><br></pre></td></tr></table></figure>

<p>可得到成功的返回结果。通过 Telegram 可知 ，群组收到了 Bot 发来的测试消息。</p>
<img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpaqgu9ftij30u00yvdhh.jpg" width="700" align="bottom">
<center>群组</center>



<h4><span id="shan-chu-bot">删除 Bot</span><a href="#shan-chu-bot" class="header-anchor">#</a></h4><p>通过 &#x2F;mybots 指令查看我的 Bot，先是一个或者多个。</p>
<p>点击 delete Bot 指令，经过几次重复确认后，可以删除没用的 Bot。<br><img src="https://tva1.sinaimg.cn/large/008eGmZEgy1gpaqhpon7pj30vm0j20vr.jpg" width="700" align="bottom"></p>
<center>删除Bot</center>

      
	</div>

<div class="meta">
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="2021/03/14/mysql-date-time/">MySQL常用日期和时间函数</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2021-03-14T08:00:00.000Z" itemprop="datePublished">Mar 14, 2021</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/mysql/">mysql</a>
</div>
    </div>
      
        <h4><span id="ri-qi-x2f-shi-jian-biao-shi">日期&#x2F;时间表示</span><a href="#ri-qi-x2f-shi-jian-biao-shi" class="header-anchor">#</a></h4><ol>
<li><p>返回当前日期时间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;   SELECT NOW();   ## 同CURRENT_TIMESTAMP(),返回一个 datetime 表达式</span><br><span class="line">&lt;.  2021-03-14 15:37:16</span><br></pre></td></tr></table></figure></li>
<li><p>返回当前日期</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;   SELECT DATE(NOW());  ## 同CURRENT_DATE() 和 CURDATE()</span><br><span class="line">&lt;.  2021-03-14</span><br></pre></td></tr></table></figure></li>
<li><p>返回当前时间</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;   SELECT TIME(NOW());  ## 同CURRENT_TIME() 和 CURTIME()</span><br><span class="line">&lt;.  15:41:19</span><br></pre></td></tr></table></figure></li>
<li><p>单独返回年&#x2F;月&#x2F;日&#x2F;时&#x2F;分&#x2F;秒</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&gt;   SELECT YEAR(NOW());</span><br><span class="line">&lt;.  2021</span><br><span class="line">&gt;   SELECT MONTH(NOW());</span><br><span class="line">&lt;.  3</span><br><span class="line">&gt;   SELECT DAY(NOW());</span><br><span class="line">&lt;.  14</span><br><span class="line">&gt;   SELECT HOUR(NOW());</span><br><span class="line">&lt;.  15</span><br><span class="line">&gt;   SELECT MINUTE(NOW());</span><br><span class="line">&lt;.  49</span><br><span class="line">&gt;   SELECT SECOND(NOW());</span><br><span class="line">&lt;.  43</span><br></pre></td></tr></table></figure>
</li>
<li><p>另一种方式单独返回年&#x2F;月&#x2F;日&#x2F;时&#x2F;分&#x2F;秒</p>
</li>
</ol>
<p>使用 <code>EXTRACT(unit FROM date)</code> 函数，<code>unit</code> 为要返回值类型，<code>date</code> 为日期时间表达式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;   SELECT EXTRACT(YEAR FROM NOW());</span><br><span class="line">&lt;.  2021</span><br></pre></td></tr></table></figure>
<blockquote>
<p>unit包括：YEAR,MONTH,DAY,HOUR,MINUTE,SECOND,MICROSECOND等等。</p>
</blockquote>
<p>使用 <code>DATE_FORMAT(date,format)</code> 函数，<code>date</code> 为日期时间表达式，<code>format</code> 为要返回的日期格式。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;   SELECT DATE_FORMAT(NOW(),&quot;%Y&quot;);</span><br><span class="line">&lt;.  2021</span><br></pre></td></tr></table></figure>
<p>常用的日期时间格式有：</p>
<table>
<thead>
<tr>
<th>格式</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>%Y</td>
<td>4位数字年份</td>
</tr>
<tr>
<td>%m</td>
<td>2位数字月份 (00 to 12)</td>
</tr>
<tr>
<td>%d</td>
<td>2位数字日期 (01 to 31)</td>
</tr>
<tr>
<td>%H</td>
<td>小时 (00 to 23)</td>
</tr>
<tr>
<td>%i</td>
<td>分钟 (00 to 59)</td>
</tr>
<tr>
<td>%s</td>
<td>秒钟 (00 to 59)</td>
</tr>
<tr>
<td>%f</td>
<td>毫秒 (000000 to 999999)</td>
</tr>
</tbody></table>
<p>更多的日期时间格式查看 <a target="_blank" rel="noopener" href="https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_date-format">Date and Time Functions</a> 文档。</p>
<h4><span id="ri-qi-x2f-shi-jian-ji-suan">日期&#x2F;时间计算</span><a href="#ri-qi-x2f-shi-jian-ji-suan" class="header-anchor">#</a></h4><ol>
<li><p>加 x 年&#x2F;月&#x2F;日&#x2F;时&#x2F;分&#x2F;秒</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;   SELECT NOW();</span><br><span class="line">&lt;.  2021-03-14 18:21:18</span><br><span class="line">&gt;   SELECT DATE_ADD(NOW(),INTERVAL 1 HOUR);</span><br><span class="line">&lt;.  2021-03-14 19:21:18</span><br></pre></td></tr></table></figure></li>
<li><p>减 x 年&#x2F;月&#x2F;日&#x2F;时&#x2F;分&#x2F;秒</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;   SELECT NOW();</span><br><span class="line">&lt;.  2021-03-14 18:23:07</span><br><span class="line">&gt;   SELECT DATE_SUB(NOW(),INTERVAL 1 DAY);</span><br><span class="line">&lt;.  2021-03-13 18:23:07</span><br></pre></td></tr></table></figure>
</li>
<li><p>计算两个日期时间之差</p>
</li>
</ol>
<p>使用 <code>DATEDIFF(date1,date2)</code> 函数计算两个日期相差几天。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;   SELECT DATEDIFF(DATE_ADD(NOW(),  INTERVAL 1 DAY),CURDATE());</span><br><span class="line">&lt;.  1</span><br></pre></td></tr></table></figure>
<p>使用 <code>TIMEDIFF(time1,time2)</code> 函数计算两个时间相差多少小时多少分钟多少秒钟。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&gt;   SELECT TIMEDIFF(DATE_ADD(CURTIME(),INTERVAL 1 HOUR),CURTIME());</span><br><span class="line">&lt;.  01:00:00</span><br></pre></td></tr></table></figure>

<h4><span id="ri-qi-shi-jian-yu-unix-shi-jian-chuo-hu-xiang-zhuan-huan">日期时间与unix时间戳互相转换</span><a href="#ri-qi-shi-jian-yu-unix-shi-jian-chuo-hu-xiang-zhuan-huan" class="header-anchor">#</a></h4><ol>
<li><p>日期时间 转 时间戳<br>函数 <code>UNIX_TIMESTAMP(datetime)</code> 带一个日期时间表达式参数，当不带参数时，相当于 <code>datetime=now()</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;   SELECT UNIX_TIMESTAMP();</span><br><span class="line">&lt;.  1615721103</span><br><span class="line">&gt;   SELECT UNIX_TIMESTAMP(DATE_ADD(NOW(),INTERVAL 1 DAY));      # 返回明天的时间戳</span><br><span class="line">&lt;.  1615807716</span><br></pre></td></tr></table></figure>
</li>
<li><p>时间戳 转 日期时间<br>函数 <code>FROM_UNIXTIME(unix_timestamp,format)</code> 有两个参数， <code>unix_timestamp</code> 参数必须，表示时间戳，<code>format</code> 参数可选，表示日期时间格式，当 <code>format</code> 为空时，表示返回 <code>&quot;%Y-%m-%d %H:%i:%s&quot;</code> 格式的日期时间。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;   SELECT FROM_UNIXTIME(1615807716);</span><br><span class="line">&lt;.  2021-03-15 19:28:36</span><br><span class="line">&gt;   SELECT FROM_UNIXTIME(1615807716,&quot;%Y-%m-%d&quot;);</span><br><span class="line">&lt;.  2021-03-15</span><br></pre></td></tr></table></figure></li>
</ol>

      
	</div>

<div class="meta">
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="2021/03/12/delete-log/">使用PHP和SHELL脚本删除日志</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2021-03-12T11:00:00.000Z" itemprop="datePublished">Mar 12, 2021</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/php/">php</a> <a href="/tags/shell/">shell</a>
</div>
    </div>
      
        <h4><span id="si-lu">思路</span><a href="#si-lu" class="header-anchor">#</a></h4><p>一般来说，日志文件都是按照日期来命名的，例如这样: <code>21_03_01.log</code>。</p>
<p>每一个日志文件只记录当天某个功能的日志信息，这种做法方便于定为错误。</p>
<p>通过日志文件的属性——最后修改时间，可以得知日志文件记录的是哪一天的日志，距离现在过去多少天了。</p>
<p>当每天的日志量不多，可以考虑保存最近30天的日志量，保存再多也没有意义。</p>
<p>当每日的日志量很多的话，出于存储空间的考虑，可以考虑保存最近7天的日志量。</p>
<h4><span id="shi-yong-php-shan-chu-ri-zhi-wen-jian">使用PHP删除日志文件</span><a href="#shi-yong-php-shan-chu-ri-zhi-wen-jian" class="header-anchor">#</a></h4><p>需要删除日志文件的时候，通过web端手动调用接口 或者 通过 CLI 的方式，自动定时的调用接口，删除日志文件。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//删除日志文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">delLogs</span>(<span class="params"><span class="variable">$day</span>=<span class="number">30</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$day</span> &lt; <span class="number">8</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;保留不少于一个星期的日志文件&quot;</span>;</span><br><span class="line">        <span class="keyword">die</span>;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="variable">$logDir</span> = <span class="title function_ invoke__">realpath</span>(LOG_PATH);   </span><br><span class="line">    <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">delLogs2</span>(<span class="variable">$logDir</span>,<span class="variable">$day</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">delLogs2</span>(<span class="params"><span class="variable">$logDir</span>,<span class="variable">$day</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="variable">$dh</span> = <span class="title function_ invoke__">opendir</span>(<span class="variable">$logDir</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$dh</span>)&#123;</span><br><span class="line">        <span class="keyword">while</span>(<span class="variable">$file</span> = <span class="title function_ invoke__">readdir</span>(<span class="variable">$dh</span>))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$file</span> == <span class="string">&#x27;.&#x27;</span> || <span class="variable">$file</span> == <span class="string">&#x27;..&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">            <span class="variable">$filePath</span> = <span class="variable">$logDir</span>.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="title function_ invoke__">is_file</span>(<span class="variable">$filePath</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="title function_ invoke__">filemtime</span>(<span class="variable">$filePath</span>) &lt; <span class="title function_ invoke__">strtotime</span>(<span class="string">&quot;-<span class="subst">&#123;$day&#125;</span> days&quot;</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">&quot;file=<span class="subst">&#123;$filePath&#125;</span>&quot;</span>;</span><br><span class="line">                    <span class="title function_ invoke__">unlink</span>(<span class="variable">$filePath</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">delLogs2</span>(<span class="variable">$filePath</span>,<span class="variable">$day</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="title function_ invoke__">closedir</span>(<span class="variable">$dh</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;目录错误：<span class="subst">&#123;$logDir&#125;</span>&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4><span id="shi-yong-shell-jiao-ben-shan-chu-ri-zhi-wen-jian">使用SHELL脚本删除日志文件</span><a href="#shi-yong-shell-jiao-ben-shan-chu-ri-zhi-wen-jian" class="header-anchor">#</a></h4><p>使用 <code>find</code> 命令，查找日志目录下的名字格式为 <code>&quot;*.log&quot;</code> ，最后修改时间为20天以前的文件，把找到的文件删除掉。</p>
<p>把命令写入 <code>delLogs.sh</code> 文件，通过终端命令<code>sh delLogs.sh</code>执行。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> start delete <span class="built_in">log</span> 20 days ago...</span><br><span class="line">find /app/Logs/ -mtime +20 -name <span class="string">&quot;*.log&quot;</span> -<span class="built_in">exec</span>  <span class="built_in">rm</span> -rf &#123;&#125; \;</span><br><span class="line"><span class="built_in">echo</span> end delete <span class="built_in">log</span>...</span><br></pre></td></tr></table></figure>

      
	</div>

<div class="meta">
	
</div>
</article>

  <article class="post">
	<h2 class="title">
		<a href="2020/12/23/mysql-partition/">MySQL的RANGE分区管理与预警</a>
	</h2>
    <div class="entry-content">
    <div class="meta">
      <div class="date">Published on: <time datetime="2020-12-23T10:30:00.000Z" itemprop="datePublished">Dec 23, 2020</time>
</div>
      <div class="tags">Tags: 

<a href="/tags/mysql/">mysql</a>
</div>
    </div>
      
        <p>MySQL有四种分区类型，分别是RANGE分区、LIST分区、HASH分区和KEY分区。其中数RANGE分区使用最为普遍。</p>
<p>RANGE分区基于一个给定的分区键和分区值，把一个大的数据表分成多个连续且不重复的分区表。物理层面上是把一个大文件分割成多个小的文件。</p>
<h4><span id="shu-ju-biao-fen-qu-de-liang-chong-fang-shi">数据表分区的两种方式</span><a href="#shu-ju-biao-fen-qu-de-liang-chong-fang-shi" class="header-anchor">#</a></h4><p>方式一，创建表的同时，设置表分区</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> tablename(col1,col2,col3,...)</span><br><span class="line"><span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">RANGE</span>(col_key)</span><br><span class="line">(</span><br><span class="line">    <span class="keyword">PARTITION</span> p1 <span class="keyword">VALUES</span> LESS THAN (value1),</span><br><span class="line">    <span class="keyword">PARTITION</span> p2 <span class="keyword">VALUES</span> LESS THAN (value2),</span><br><span class="line">    <span class="keyword">PARTITION</span> p3 <span class="keyword">VALUES</span> LESS THAN (value3),</span><br><span class="line">    <span class="keyword">PARTITION</span> p_maxvalue <span class="keyword">VALUES</span> LESS THAN (MAXVALUE)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>方式二，对已创建的表分区</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> tablename <span class="keyword">PARTITION</span> <span class="keyword">BY</span> <span class="keyword">RANGE</span>(col_key) </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">PARTITION</span> p1 <span class="keyword">VALUES</span> LESS THAN (value1),</span><br><span class="line">    <span class="keyword">PARTITION</span> p2 <span class="keyword">VALUES</span> LESS THAN (value2),</span><br><span class="line">    <span class="keyword">PARTITION</span> p3 <span class="keyword">VALUES</span> LESS THAN (value3),</span><br><span class="line">    <span class="keyword">PARTITION</span> p_maxvalue <span class="keyword">VALUES</span> LESS THAN (MAXVALUE)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>分区的时候，最好设置一个最大分区 <code>p_maxvalue</code></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">PARTITION</span> p_maxvalue <span class="keyword">VALUES</span> LESS THAN (MAXVALUE)</span><br></pre></td></tr></table></figure>
<p>存放意料之外的数据。例如：</p>
<ul>
<li>当出现错误数据，大于所有分区值时，会存放到 <code>p_maxvalue</code> 分区</li>
<li>当来不及增加分区时，数据会存放到 <code>p_maxvalue</code> 分区，且对前面的分区无影响</li>
</ul>
<p>总之，设置 <code>p_maxvalue</code> 分区并不是为了存放数据，而是在出现意外的时候，程序不至于报错。</p>
<h4><span id="xian-shi-yi-fen-qu-de-shu-ju-biao">显示已分区的数据表</span><a href="#xian-shi-yi-fen-qu-de-shu-ju-biao" class="header-anchor">#</a></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	TABLE_NAME tname,                   <span class="comment">-- 数据表名</span></span><br><span class="line">	TABLE_ROWS trow                     <span class="comment">-- 数据行数</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	information_schema.`TABLES`</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	TABLE_SCHEMA <span class="operator">=</span> &#123;$dbName&#125;</span><br><span class="line"><span class="keyword">AND</span> CREATE_OPTIONS <span class="keyword">LIKE</span> <span class="string">&#x27;%partitioned%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<img src="http://tva1.sinaimg.cn/large/7d4c6366gy1glxvwlv028j20zu09j0sw.jpg" width="700" align="bottom">
<center>显示分区的数据表</center>

<h4><span id="xian-shi-mou-ge-biao-de-fen-qu-lie-biao">显示某个表的分区列表</span><a href="#xian-shi-mou-ge-biao-de-fen-qu-lie-biao" class="header-anchor">#</a></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">	PARTITION_ORDINAL_POSITION onum,    <span class="comment">-- 分区序号</span></span><br><span class="line">	PARTITION_NAME pname,               <span class="comment">-- 分区名字</span></span><br><span class="line">	PARTITION_METHOD pmethod,           <span class="comment">-- 分区方式</span></span><br><span class="line">	PARTITION_EXPRESSION pkey,          <span class="comment">-- 分区键</span></span><br><span class="line">	PARTITION_DESCRIPTION pvalue,       <span class="comment">-- 分区值</span></span><br><span class="line">	TABLE_ROWS trows                    <span class="comment">-- 数据行数</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">	information_schema.`PARTITIONS`</span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">	TABLE_SCHEMA <span class="operator">=</span> &#123;$dbName&#125;</span><br><span class="line"><span class="keyword">AND</span> TABLE_NAME <span class="operator">=</span> &#123;$tname&#125;;</span><br></pre></td></tr></table></figure>

<img src="http://tvax4.sinaimg.cn/large/7d4c6366gy1glxw1kt2cnj20q60l074y.jpg" width="700" align="bottom">
<center>分区列表</center>

<h4><span id="shan-chu-fen-qu">删除分区</span><a href="#shan-chu-fen-qu" class="header-anchor">#</a></h4><p>当历史数据归档后，分区的数据行数为0，此时该分区已经无用，为了减少系统的文件数，可以把它删除掉。</p>
<img src="http://tvax2.sinaimg.cn/large/7d4c6366gy1glxwhqxvfej20q00kvdgh.jpg" width="700" align="bottom">
<center>数据归档的分区</center>


<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> &#123;$dbName&#125;.&#123;$tname&#125; <span class="keyword">DROP</span> <span class="keyword">PARTITION</span> &#123;$pname&#125;;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>使用 DROP PARTITION 删除分区的同时，也会删除分区里的数据</p>
</blockquote>
<h4><span id="qu-xiao-fen-qu">取消分区</span><a href="#qu-xiao-fen-qu" class="header-anchor">#</a></h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> &#123;$dbName&#125;.&#123;$tname&#125; REMOVE PARTITIONING;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>取消分区对表数据无影响</p>
</blockquote>
<h4><span id="zeng-jia-fen-qu">增加分区</span><a href="#zeng-jia-fen-qu" class="header-anchor">#</a></h4><p>增加分区之前，需要删除最大分区 <code>p_maxvalue</code>。<br>因为分区是连续递增的，所以需要把最大分区 <code>p_maxvalue</code> 删除，再增加新的分区。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> &#123;$dbName&#125;.&#123;$tname&#125; <span class="keyword">ADD</span> <span class="keyword">PARTITION</span> </span><br><span class="line">(</span><br><span class="line">    <span class="keyword">PARTITION</span> &#123;$pname&#125; <span class="keyword">VALUES</span> LESS THAN (value1)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h4><span id="chai-fen-fen-qu">拆分分区</span><a href="#chai-fen-fen-qu" class="header-anchor">#</a></h4><p>当来不及增加分区时，数据会存放到 <code>p_maxvalue</code> 分区。当发现 <code>p_maxvalue</code> 分区有数据时，应该尽快创建新分区，并把数据迁移到新分区上。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> &#123;$dbName&#125;.&#123;$tname&#125; REORGANIZE <span class="keyword">PARTITION</span> p_maxvalue <span class="keyword">INTO</span> </span><br><span class="line">(</span><br><span class="line">	<span class="keyword">PARTITION</span> p_20210301 <span class="keyword">VALUES</span> less than (<span class="number">1614528000</span>),</span><br><span class="line">	<span class="keyword">PARTITION</span> p_maxvalue <span class="keyword">VALUES</span> less than (MAXVALUE)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>
<p>此时数据保存到了 <code>p_20210301</code> 分区，通过</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> ....;</span><br></pre></td></tr></table></figure>
<p>可以看到 <code>partitions</code> 字段的值为 <code>p_20210301</code> ,表示查询的内容在 <code>p_20210301</code> 分区。</p>
<p>此时若发现查询并未使用到索引，则需要优化一下分区。</p>
<p>执行语句：</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> &#123;$dbName&#125;.&#123;$tname&#125; REBUILD <span class="keyword">PARTITION</span> p_maxvalue,p_20210301;         <span class="comment">-- 重建分区</span></span><br><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> &#123;$dbName&#125;.&#123;$tname&#125; ANALYZE <span class="keyword">PARTITION</span> p_maxvalue,p_20210301;         <span class="comment">-- 分析分区</span></span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ALTER</span> <span class="keyword">TABLE</span> &#123;$dbName&#125;.&#123;$tname&#125; OPTIMIZE <span class="keyword">PARTITION</span> p_maxvalue,p_20210301;;</span><br></pre></td></tr></table></figure>
<p>再次执行查询语句</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">EXPLAIN <span class="keyword">SELECT</span> ....;</span><br></pre></td></tr></table></figure>
<p>发现已经使用了索引。</p>
<blockquote>
<p>REORGANIZE PARTITION 也可以用于重命名分区，重命名分区后也需要执行一下优化分区语句。</p>
</blockquote>
<h4><span id="fen-qu-yu-jing">分区预警</span><a href="#fen-qu-yu-jing" class="header-anchor">#</a></h4><p>以下分区预警思路针对RANGE分区类型，基于时间的连续分区。</p>
<p>使用分区预警的好处有：</p>
<ul>
<li>可以提前知晓备用的分区不足，不用逐个表检查</li>
<li>可以不用一下子准备多个备用分区，减少分区数量</li>
</ul>
<p>分区预警的思路如下代码：</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 分区预警，预警值默认60天</span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">static</span> <span class="function"><span class="keyword">function</span> <span class="title">warningPartition</span>(<span class="params"><span class="variable">$warningDays</span>=<span class="number">60</span></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 获取所有的数据库</span></span><br><span class="line">    <span class="variable">$dbNames</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">get_all_db</span>();</span><br><span class="line">    <span class="variable">$result</span> = [];</span><br><span class="line">    <span class="keyword">foreach</span>(<span class="variable">$dbNames</span> <span class="keyword">as</span> <span class="variable">$dbName</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 获取指定数据库的分区表列表</span></span><br><span class="line">        <span class="variable">$sqlTable</span> = <span class="string">&quot;SELECT TABLE_NAME tname,TABLE_ROWS trow FROM information_schema.`TABLES` WHERE TABLE_SCHEMA=&#x27;<span class="subst">&#123;$dbName&#125;</span>&#x27; AND CREATE_OPTIONS LIKE &#x27;%partitioned%&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$listTable</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">querySql</span>(<span class="variable">$sqlTable</span>);</span><br><span class="line">        <span class="keyword">foreach</span>(<span class="variable">$listTable</span> <span class="keyword">as</span> <span class="variable">$table</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 获取指定数据库，指定表的除p_maxvalue外的最大分区的值</span></span><br><span class="line">            <span class="variable">$sqlPartition</span> = <span class="string">&quot;SELECT PARTITION_NAME pname,PARTITION_DESCRIPTION pvalue FROM information_schema.`PARTITIONS` WHERE TABLE_SCHEMA=&#x27;<span class="subst">&#123;$dbName&#125;</span>&#x27; AND TABLE_NAME=&#x27;<span class="subst">&#123;$table&#125;</span>&#x27; AND PARTITION_NAME != &#x27;p_maxvalue&#x27; ORDER BY PARTITION_DESCRIPTION DESC LIMIT 1&quot;</span>;</span><br><span class="line">            <span class="variable">$listPartition</span> = <span class="built_in">self</span>::<span class="title function_ invoke__">querySql</span>(<span class="variable">$sqlPartition</span>);</span><br><span class="line">            <span class="variable">$pvalue</span> = <span class="variable">$listPartition</span>[<span class="number">0</span>][<span class="string">&#x27;pvalue&#x27;</span>];</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 最大分区的值小于阈值，则保存预警信息</span></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$pvalue</span> - <span class="title function_ invoke__">time</span>() &lt; <span class="variable">$warningDays</span> * <span class="number">86400</span>)</span><br><span class="line">                <span class="variable">$result</span>[] = <span class="string">&quot;数据表：<span class="subst">&#123;$dbName&#125;</span>.<span class="subst">&#123;$table&#125;</span>，最新分区：<span class="subst">&#123;$listPartition[0][&#x27;pname&#x27;]&#125;</span> - <span class="subst">&#123;$listPartition[0][&#x27;pvalue&#x27;]&#125;</span>，预警阈值：<span class="subst">&#123;$warningDays&#125;</span>天&quot;</span>;  </span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>分区预警程序 + <a href="/2021/04/07/telegram">Telegram机器人</a>可以实时的收到预警信息。</p>

      
	</div>

<div class="meta">
	
</div>
</article>


  <nav id="pagenavi">
    
        <a href="/page/2/" class="prev">Prev</a>
    
    
        <a href="/page/4/" class="next">Next</a>
    
  <div class="center"><a href="/archives/index.html">Blog Archives</a></div>
  </nav>


    </div>
    <footer id="footer">
    <div style="display:inline">
    Copyright &copy; 2023

    CFONG
. Powered by <a href="http://zespia.tw/hexo/" target="_blank">Hexo</a> |
    Theme is <a target="_blank" rel="noopener" href="https://github.com/wd/hexo-fabric">hexo-fabric</a>, fork from <a target="_blank" rel="noopener" href="http://github.com/panks/fabric">fabric</a> by <a target="_blank" rel="noopener" href="http://panks.me">Pankaj Kumar</a>
</div>


    </footer>
    <script src="/javascripts/fabric.js"></script>
<script src="/javascripts/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
	$('.fancybox').fancybox();
})(jQuery);
</script>
 <!-- Delete or comment this line to disable Fancybox -->



<!-- end toload --> 
</div>
</div>
<script src="/javascripts/jquery.ui.totop.js" type="text/javascript"></script>
<script type="text/javascript">
/*<![CDATA[*/
;(function($){$().UItoTop({easingType:'easeOutCirc'});})(jQuery); 
/*]]>*/
</script><!-- remove it to remove the scroll to top button -->
</body>
</html>
